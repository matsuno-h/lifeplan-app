# ライフプランニング & キャッシュフロー表

## プロジェクト概要
このプロジェクトは、将来の資産推移をシミュレーションするためのWebアプリケーションです。
ユーザーは自身のプロフィール、収入、支出、家族構成、資産、保険、ローンなどの情報を入力し、95歳までのキャッシュフローと資産推移をグラフと表で確認できます。

## 認証とデータ管理
このアプリケーションは、Supabaseを使用してユーザー認証とデータ永続化を実現しています。

### ユーザー認証機能
- **メール/パスワード認証**: ユーザーはメールアドレスとパスワードで登録・ログインできます
- **プロフィール管理**: ユーザーは名前、メールアドレス、パスワードを編集できます
- **複数プランの管理**: ユーザーは複数のライフプランを作成・管理できます

### 共有機能
- **プラン共有**: ライフプランを他のユーザーと共有できます
- **権限管理**: 閲覧のみまたは編集可能の権限を設定できます
- **招待メール**: 共有時に招待メールが自動送信されます（Resend API設定時）

### AI相談機能（Gemini API）
- **CFPレベルのアドバイス**: Google Gemini API（最新版）を使用して、FP協会が提唱する6分野に基づいた専門的なライフプラン診断を提供します
- **環境変数設定**: 本機能を有効にするには、Supabase Edge Functionsに`GEMINI_API_KEY`環境変数を設定する必要があります

#### Gemini APIキーの設定手順
1. [Google AI Studio](https://aistudio.google.com/app/apikey)にアクセスし、Gemini APIキーを取得
2. Supabaseダッシュボードにログイン
3. プロジェクト設定 > Edge Functions > Secrets に移動
4. 新しいシークレット`GEMINI_API_KEY`を作成し、取得したAPIキーを設定
5. Edge Function `generate-fp-advice` を再デプロイ（自動で有効化されます）

## 現在の実装状況

### 基本機能
- **データ保存/読み込み**: LocalStorageを使用したデータ永続化。JSONファイルへのエクスポート/インポート機能。
- **リセット機能**: データを初期状態に戻す機能。
- **CSV出力**: キャッシュフロー表のCSVダウンロード機能。画面表示と同様の行列（横軸が年）形式で、詳細内訳も出力されます。

### 画面構成（タブ）
1.  **目標設定**: 人生の目標や理想のライフスタイルを自由に記述できるメモ機能（Q1〜Q4）。
2.  **基本設定**: プロフィール（名前、生年月日）、家族構成、共通設定（退職年齢、寿命、現在貯蓄など）。
3.  **収支**: 収入源、基本生活費、教育資金、ライフイベント。
4.  **住宅・ローン**: 賃貸/持ち家の詳細設定、ローン返済計画。
5.  **資産管理**: 預金、株式、投資信託などの資産管理（積立・取り崩し対応）、不動産投資。
6.  **保険・年金**: 生命保険、個人年金などの管理。
7.  **相談**: AIによるライフプラン診断とアドバイス。

### シミュレーション機能
- **資産推移グラフ**: 下から「不動産（・敷金）」「金融資産」「現金資産」の順に積み上げられる面グラフ。
- **キャッシュフロー表**: 年齢ごとの詳細な収支内訳を表示。
    - **詳細展開機能**: 収入、支出、資産残高、**金融資産取崩**の各項目をクリックすると、内訳を展開して確認できます。
- **ローン返済残高一覧表**: 各種ローン（住宅、不動産投資、その他）の残高推移を一覧表示します。
- **AI診断**: 入力されたデータに基づいて、資金ショートのリスクや老後資金の状況を分析し、具体的なアドバイスを提示します。
    - **目標との照合**: 「目標設定」に入力された内容を引用し、シミュレーション結果（資金枯渇など）と照らし合わせた具体的なアドバイスを行います。

## 公開（デプロイ）時の注意点
**修正内容を公開サイトに反映するには、必ず「Publish」タブからデプロイを実行してください。**
デプロイ後も古い表示のままの場合は、ブラウザのキャッシュクリア（スーパーリロード: Ctrl+F5 / Cmd+Shift+R）をお試しください。

## 最新の修正内容 (2026-01-07)
- **フッターリンクの設定**: コピーライト表記に公式サイトへのリンクを設定しました。
- **相談タブの文言完全修正**: プログラム内で生成されるテキストを含め、「FP」という表現を排除し「AI」に統一しました。ボタン名も「AIに相談」に変更しました。
- **AI FPアドバイスの強化**: 目標設定の内容を反映し、寄り添いつつも厳しい現実を指摘するロジックに変更しました。
- **「目標設定」タブの新設**: ライフプランの前提となる目標や価値観を記述・保存できる機能を一番左のタブに追加しました。
- **資産推移グラフの積み上げ順序変更**: グラフの下から「不動産」→「金融資産」→「現金資産」の順になるように変更しました。
- **タブ名称の変更**: 「収入・支出」を「収支」に、「アドバイス」を「相談」に変更しました。

## 技術スタック
- HTML5
- Tailwind CSS (CDN)
- JavaScript (Vanilla)
- Chart.js (CDN)
- Font Awesome (CDN)
